<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DADUit Game - Malaysia Edition</title>
    
    <!-- SEO and Social Media Share Information -->
    <meta name="description" content="DaDuit game is envisioned as a digital learning tool that delivers financial literacy education through gamified modules, enhancing user engagement and knowledge retention">
    <meta property="og:title" content="DADUit Game - Malaysia Edition">
    <meta property="og:description" content="DaDuit game is envisioned as a digital learning tool that delivers financial literacy education through gamified modules, enhancing user engagement and knowledge retention">
    <meta property="og:image" content="https://finebank.github.io/uitmsabah/Daduit_20250426_131658_0000.png">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#6366F1">

    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366F1;
            --primary-hover: #4F46E5;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
            --info-color: #3B82F6;
            
            --bg-light: #F9FAFB;
            --text-light: #1F2937;
            --border-light: #E5E7EB;
            --card-bg-light: #FFFFFF;

            --bg-dark: #111827;
            --text-dark: #F3F4F6;
            --border-dark: #374151;
            --card-bg-dark: #1F2937;
        }

        .dark {
            --bg-color: var(--bg-dark);
            --text-color: var(--text-dark);
            --border-color: var(--border-dark);
            --card-bg: var(--card-bg-dark);
        }

        :root:not(.dark) {
            --bg-color: var(--bg-light);
            --text-color: var(--text-light);
            --border-color: var(--border-light);
            --card-bg: var(--card-bg-light);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; width: 100%; }
        main.container { flex-grow: 1; }

        /* --- Header & Dice --- */
        .game-header{background:linear-gradient(135deg,#6366f1 0%,#8b5cf6 50%,#ec4899 100%);padding:30px 0;position:relative;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.2);margin-bottom:30px}.header-content{display:flex;justify-content:space-between;align-items:center;position:relative;z-index:2}.header-title{color:white;font-size:2.8rem;font-weight:800;text-shadow:2px 2px 8px rgba(0,0,0,0.3);letter-spacing:-1px;margin:0}.header-subtitle{color:rgba(255,255,255,0.9);font-size:1.1rem;margin-top:5px;font-weight:300}.header-bg-pattern{position:absolute;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");opacity:0.5}.dice-container{display:flex;gap:20px;perspective:1000px}.dice{width:60px;height:60px;position:relative;transform-style:preserve-3d;transition:transform 1.5s ease-out;cursor:pointer}.dice-face{position:absolute;width:100%;height:100%;border-radius:10px;background:white;box-shadow:inset 0 0 10px rgba(0,0,0,0.1);display:flex;justify-content:center;align-items:center;font-size:0}.dice-face:nth-child(1){transform:translateZ(30px)}.dice-face:nth-child(2){transform:rotateY(180deg) translateZ(30px)}.dice-face:nth-child(3){transform:rotateY(90deg) translateZ(30px)}.dice-face:nth-child(4){transform:rotateY(-90deg) translateZ(30px)}.dice-face:nth-child(5){transform:rotateX(90deg) translateZ(30px)}.dice-face:nth-child(6){transform:rotateX(-90deg) translateZ(30px)}.dice-dot-container{width:48px;height:48px;display:grid;grid-template-rows:repeat(3,1fr);grid-template-columns:repeat(3,1fr);gap:4px}.dice-dot{width:100%;height:100%;border-radius:50%;background-color:#333;box-shadow:inset 0 0 2px rgba(0,0,0,0.5)}.face-1 .dice-dot:nth-child(1){grid-area:2 / 2}.face-2 .dice-dot:nth-child(1){grid-area:1 / 1}.face-2 .dice-dot:nth-child(2){grid-area:3 / 3}.face-3 .dice-dot:nth-child(1){grid-area:1 / 1}.face-3 .dice-dot:nth-child(2){grid-area:2 / 2}.face-3 .dice-dot:nth-child(3){grid-area:3 / 3}.face-4 .dice-dot:nth-child(1){grid-area:1 / 1}.face-4 .dice-dot:nth-child(2){grid-area:1 / 3}.face-4 .dice-dot:nth-child(3){grid-area:3 / 1}.face-4 .dice-dot:nth-child(4){grid-area:3 / 3}.face-5 .dice-dot:nth-child(1){grid-area:1 / 1}.face-5 .dice-dot:nth-child(2){grid-area:1 / 3}.face-5 .dice-dot:nth-child(3){grid-area:2 / 2}.face-5 .dice-dot:nth-child(4){grid-area:3 / 1}.face-5 .dice-dot:nth-child(5){grid-area:3 / 3}.face-6 .dice-dot:nth-child(1){grid-area:1 / 1}.face-6 .dice-dot:nth-child(2){grid-area:1 / 3}.face-6 .dice-dot:nth-child(3){grid-area:2 / 1}.face-6 .dice-dot:nth-child(4){grid-area:2 / 3}.face-6 .dice-dot:nth-child(5){grid-area:3 / 1}.face-6 .dice-dot:nth-child(6){grid-area:3 / 3}

        /* --- Main Layout & Controls --- */
        .game-container { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; }
        .game-board, .stats-panel { background: var(--card-bg); padding: 25px; border-radius: 16px; box-shadow: 0 8px 16px rgba(0,0,0,0.05); border: 1px solid var(--border-color); }
        .game-path { position: relative; height: 60px; margin-bottom: 25px; background: linear-gradient(90deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1)); border-radius: 30px; }
        .player-game-pin { position: absolute; width: 40px; height: 50px; top: 5px; left: 5px; transition: left 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 10; transform-origin: bottom center; }
        .player-game-pin.is-moving { animation: bounce 0.5s ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.1); } }
        .controls { text-align: center; margin-bottom: 25px; background-color: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid var(--border-color); }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; font-size: 1.1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn:disabled { background-color: var(--neutral-color); color: white; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-hover); }
        .btn-neutral { background-color: #f3f4f6; color: #1f2937; border: 1px solid #d1d5db; }
        .dark .btn-neutral { background-color: #374151; color: #f3f4f6; border-color: #4b5563; }
        
        /* --- Calendar & Stats --- */
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day { aspect-ratio: 1; border: 1px solid var(--border-color); border-radius: 8px; padding: 5px; position: relative; background: var(--bg-color); transition: all 0.3s; text-align: center; display: flex; justify-content: flex-start; align-items: center; font-weight: 600; flex-direction: column; }
        .day.current { background: var(--primary-color); color: white; transform: scale(1.1); box-shadow: 0 0 15px var(--primary-color); z-index: 5; }
        .day.payday::after { content: "ðŸ’°"; position: absolute; bottom: 5px; right: 5px; font-size: 1.5rem; opacity: 0.8; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .stat-card { background: var(--bg-color); padding: 15px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--primary-color); }
        .stat-label { font-size: 0.9rem; color: var(--neutral-color); }
        .achievements-list { margin-top: 20px; max-height: 300px; overflow-y: auto; padding-right: 10px; }
        .achievement-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--border-color); }
        .achievement-icon { font-size: 1.5rem; color: var(--warning-color); margin-right: 15px; }
        .settings-button { text-align: right; margin-top: 20px; }
        
        /* --- Enhanced Modal & Toast --- */
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);z-index:1000;justify-content:center;align-items:center;animation:fadeIn .3s}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .modal-content{background:var(--card-bg);padding:30px;border-radius:16px;max-width:550px;width:90%;box-shadow:0 10px 25px rgba(0,0,0,0.2);position:relative;animation:zoomInBounce .4s cubic-bezier(0.175, 0.885, 0.32, 1.275)}
        @keyframes zoomInBounce {0%{opacity:0;transform:scale(.7)}60%{opacity:1;transform:scale(1.05)}100%{transform:scale(1)}}
        .modal-close{position:absolute;top:15px;right:20px;font-size:1.8rem;cursor:pointer;color:var(--neutral-color)}.modal-header{margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid var(--border-color)}.modal-title{font-size:1.6rem;font-weight:700}.modal-description{margin-bottom:20px;line-height:1.7}.modal-options{display:flex;flex-direction:column;gap:10px}.modal-option{padding:12px 15px;border-radius:8px;background:var(--bg-color);border:1px solid var(--border-color);cursor:pointer;transition:all .2s;display:flex;justify-content:space-between;align-items:center}.modal-option:hover{background:var(--primary-color);color:white;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.1)}.option-text{flex-grow:1;font-weight:600}.modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}
        .toast-container{position:fixed;bottom:20px;right:20px;z-index:1001;display:flex;flex-direction:column;gap:10px}.toast{background:var(--card-bg);color:var(--text-color);padding:12px 20px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:flex;align-items:center;gap:15px;min-width:320px;animation:slideIn .3s ease-out forwards;position:relative;overflow:hidden;border-left:4px solid var(--primary-color)}.toast.success{border-left-color:var(--success-color)}.toast.warning{border-left-color:var(--warning-color)}.toast.error{border-left-color:var(--danger-color)}.toast-icon{font-size:1.5rem}.toast.success .toast-icon{color:var(--success-color)}.toast.warning .toast-icon{color:var(--warning-color)}.toast.error .toast-icon{color:var(--danger-color)}.toast-title{font-weight:600}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{to{transform:translateX(120%);opacity:0}}
        
        /* --- Helpers --- */
        .confetti { position: fixed; width: 10px; height: 10px; background-color: #f00; pointer-events: none; z-index: 2000; }
        .theme-toggle { position: fixed; top: 20px; right: 20px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 100; }
        footer { text-align: center; padding: 25px; margin-top: 40px; font-size: 0.85rem; color: var(--neutral-color); border-top: 1px solid var(--border-color); background-color: var(--card-bg); }
        
        /* --- Responsive --- */
        @media (max-width: 992px) { .game-container { grid-template-columns: 1fr; } .header-content { flex-direction: column; text-align: center; gap: 20px; } }
        @media (max-width: 768px) { .calendar { grid-template-columns: repeat(5, 1fr); } }
    </style>
</head>
<body>
    <div class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></div>

    <header class="game-header">
        <div class="header-bg-pattern"></div>
        <div class="container header-content">
            <div>
                <h1 class="header-title">DADUit Game</h1>
                <p class="header-subtitle">Your Malaysian financial adventure!</p>
            </div>
            <div class="dice-container">
                <div class="dice" id="dice1"></div>
                <div class="dice" id="dice2"></div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="controls">
            <button class="btn btn-primary" id="rollDiceBtn"><i class="fas fa-dice-d6"></i> Roll Dice & See What Happens!</button>
        </div>

        <div class="game-container">
            <div class="game-board">
                <div class="game-path" id="gamePath">
                    <div class="player-game-pin" id="playerGamePin">
                        <svg viewBox="0 0 32 42" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 0C7.163 0 0 7.163 0 16C0 24.837 16 42 16 42C16 42 32 24.837 32 16C32 7.163 24.837 0 16 0Z" fill="url(#pinGradient)"/><circle cx="16" cy="16" r="6" fill="white"/><defs><linearGradient id="pinGradient" x1="16" y1="0" x2="16" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#8B5CF6"/><stop offset="1" stop-color="#EC4899"/></linearGradient></defs></svg>
                    </div>
                </div>
                <div id="monthHeader" style="text-align: center; font-size: 1.5rem; font-weight: 600; margin-bottom: 15px;">Month 1</div>
                <div class="calendar" id="calendar"></div>
            </div>
            
            <div class="stats-panel">
                <h2>Your Stats</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="balance">RM 2000</div>
                        <div class="stat-label">Balance</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="currentPosition">1</div>
                        <div class="stat-label">Current Day</div>
                    </div>
                </div>
                <h3 style="margin-top: 25px; margin-bottom: 10px;">Achievements</h3>
                <div class="achievements-list" id="achievementsList"></div>
                 <div class="settings-button"><button class="btn btn-danger" id="resetBtn" style="padding: 8px 16px;"><i class="fas fa-redo"></i> Reset</button></div>
            </div>
        </div>
    </main>
    
    <!-- Modals -->
    <div class="modal" id="eventModal"><div class="modal-content"><span class="modal-close">&times;</span><div class="modal-header"><h2 class="modal-title" id="eventTitle"></h2></div><p class="modal-description" id="eventDescription"></p><div class="modal-options" id="eventOptions"></div></div></div>
    <div class="modal" id="confirmModal"><div class="modal-content"><span class="modal-close">&times;</span><h2 id="confirmTitle"></h2><p id="confirmMessage"></p><div class="modal-actions"><button type="button" class="btn btn-neutral" id="cancelConfirmBtn">Cancel</button><button type="button" class="btn btn-primary" id="confirmBtn">Confirm</button></div></div></div>
    <div class="modal" id="welcomeModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">Welcome to the DADUit Game!</h2></div><p class="modal-description">Your Malaysian financial adventure begins! Navigate 60 days of daily life, making smart choices to build good habits and grow your wealth. Can you survive without going bankrupt? *Jom, kita mula!*</p><div class="modal-actions"><button class="btn btn-primary" id="startGameBtn">Let's Go!</button></div></div></div>
    <div class="toast-container" id="toastContainer"></div>

    <footer>
        <p>2025 Â© All rights reserved.</p>
        <p>The coding of this game is assisted by Generative-AI while the whole ideations and iterations process are orchestrated by the authors and developers; Fauze, Sarmila, Azrina, Ninalyn of UiTM Sabah Branch.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
    
        const eventPool = [
            { title: 'Lunch Time!', description: 'Your colleagues are going out for lunch. What do you do?', options: [
                { text: 'Join them at a cafe (-RM 30)', effect: () => gameState.balance -= 30 },
                { text: 'Suggest the nearby mamak stall (-RM 15)', effect: () => { gameState.balance -= 15; addAchievement('Frugal Foodie', 'Chose the mamak over a cafe.'); } },
                { text: 'Eat the meal you packed from home', effect: () => addAchievement('Meal Prep Master', 'Saved money by bringing food from home.') },
            ]},
            { title: 'Feeling Lazy...', description: 'You don\'t feel like cooking dinner tonight.', options: [
                { text: 'Order from GrabFood (-RM 40)', effect: () => gameState.balance -= 40 },
                { text: 'Tapau from the local warung (-RM 12)', effect: () => gameState.balance -= 12 },
                { text: 'Cook instant noodles (-RM 3)', effect: () => {gameState.balance -= 3; addAchievement('Instant Gratification', 'Survived on instant noodles.');} },
            ]},
            { title: 'TNB Bill Arrived', description: 'Your monthly electricity bill is here. The hot weather meant more air-con!', options: [{ text: 'Pay now (-RM 95)', effect: () => gameState.balance -= 95}] },
            { title: 'Internet Bill Due', description: 'Your Unifi/TIME bill needs to be paid.', options: [{ text: 'Pay now (-RM 130)', effect: () => gameState.balance -= 130 }] },
            { title: 'Commuting to Work', description: 'How are you getting to the office today?', options: [
                { text: 'Take a Grab (-RM 18)', effect: () => gameState.balance -= 18 },
                { text: 'Take the LRT/MRT (-RM 5)', effect: () => gameState.balance -= 5 },
                { text: 'Drive (Petrol & Toll) (-RM 25)', effect: () => gameState.balance -= 25 },
            ]},
            { title: 'Touch \'n Go Top-up', description: 'Your TNG balance is low, time for a top-up.', options: [ { text: 'Top up RM50', effect: () => gameState.balance -= 50}, { text: 'Top up RM100', effect: () => gameState.balance -= 100} ]},
            { title: '11.11 Sale!', description: 'The big online sale on Shopee/Lazada is happening!', options: [
                { text: 'Buy that thing you wanted (-RM 150)', effect: () => gameState.balance -= 150},
                { text: 'Just browse, no buying', effect: () => {addAchievement('Window Shopper', 'Resisted the temptation of a major sale.');}},
                { text: 'Buy a few small things (-RM 50)', effect: () => gameState.balance -= 50},
            ]},
            { title: 'Weekend Plans', description: 'A friend invites you to hang out this weekend.', options: [
                { text: 'Go watch the latest movie (-RM 45)', effect: () => gameState.balance -= 45 },
                { text: 'Go hiking at a nearby forest reserve (-RM 10)', effect: () => {gameState.balance -= 10; addAchievement('Nature Lover', 'Chose the great outdoors.');} },
                { text: 'Decline and stay home', effect: () => {} },
            ]},
             { title: 'Wedding Season!', description: 'You received a wedding invitation from a close friend.', options: [
                { text: 'Give a generous ang pow/gift (-RM 200)', effect: () => gameState.balance -= 200 },
                { text: 'Give a standard amount (-RM 100)', effect: () => gameState.balance -= 100 },
            ]},
            { title: 'Found Money!', description: 'You found RM20 in the pocket of your old jeans!', options: [{ text: 'Nice! (+RM 20)', effect: () => gameState.balance += 20 }] },
            { title: 'Car Trouble', description: 'Your car battery died and needed replacement.', options: [{ text: 'Replace it (-RM 250)', effect: () => gameState.balance -= 250 }] },
            { title: 'Mysterious SMS', description: 'You get an SMS: "CONGRATS! U have won RM5000! Pls click here and fill in ur details to claim."', options: [
                { text: 'Click the link (Risky!)', effect: () => { gameState.balance -= 500; showToast('SCAMMED!', 'It was a scam! You lost RM 500!', 'error'); addAchievement('Learned the Hard Way', 'Fell for a phishing scam.'); } },
                { text: 'Ignore and delete it (Smart!)', effect: () => { showToast('Wise Choice!', 'You correctly identified a scam.', 'success'); addAchievement('Scam Spotter', 'Avoided a phishing attempt.'); } },
            ]},
             { title: 'Investment Opportunity', description: 'You have some extra cash. What do you do with it?', options: [
                { text: 'Invest in an ASB/Unit Trust (-RM 500)', effect: () => { gameState.balance -= 500; addAchievement('Investor', 'Made your first investment.'); } },
                { text: 'Just keep it in savings', effect: () => {} },
                { text: 'Splurge on a new gadget (-RM 500)', effect: () => { gameState.balance -= 500; addAchievement('Gadget Guru', 'Bought the latest tech.'); } },
            ]},
            { title: 'PTPTN Reminder', description: 'Your PTPTN education loan repayment is due.', options: [
                { text: 'Pay now (-RM 150)', effect: () => gameState.balance -= 150 },
                { text: 'Pay minimum (-RM 50)', effect: () => {gameState.balance -= 50; showToast('Interest Accumulates', 'Paying the minimum will cost more in the long run.', 'warning');} },
                { text: 'Ignore for now (Risky!)', effect: () => {showToast('Payment Missed!', 'Missing PTPTN payments can affect your credit score.', 'error'); addAchievement('Bad Credit', 'Ignored a PTPTN payment.');} },
            ]},
            { title: 'Time for a Service!', description: 'Your car is due for its regular maintenance.', options: [
                 { text: 'Go to official service center (-RM 400)', effect: () => gameState.balance -= 400 },
                 { text: 'Go to trusted local workshop (-RM 250)', effect: () => gameState.balance -= 250 },
                 { text: 'Skip it, seems fine... (Risky!)', effect: () => {showToast('Risky Move', 'Skipping car service can lead to bigger problems later!', 'warning');} },
            ]},
            { title: 'Durian Season!', description: 'It\'s durian season! Your friends invite you to a Musang King feast.', options: [
                 { text: 'Jom! I love durian! (-RM 100)', effect: () => gameState.balance -= 100 },
                 { text: 'I\'ll just have one or two pieces (-RM 30)', effect: () => gameState.balance -= 30 },
                 { text: 'No thanks, I\'m saving money', effect: () => {} },
            ]},
            { title: 'Eh, Ada Surat Cinta!', description: 'You got a parking ticket for an expired coupon.', options: [
                 { text: 'Pay immediately (-RM 80)', effect: () => gameState.balance -= 80 },
                 { text: 'Pay within 2 weeks (-RM 100)', effect: () => gameState.balance -= 100 },
                 { text: 'Try to appeal it', effect: () => { if(Math.random() > 0.8) { showToast('Appeal Successful!', 'Your fine was waived!', 'success');} else { gameState.balance -= 100; showToast('Appeal Rejected', 'You still have to pay the fine.', 'error'); } } },
            ]},
            { title: 'Side Income Opportunity!', description: 'A client offers you a small freelance project that will take up your weekend.', options: [
                 { text: 'Accept the job (+RM 400)', effect: () => {gameState.balance += 400; addAchievement('Side Hustler', 'Earned extra income from a freelance gig.');} },
                 { text: 'Decline, I need my rest', effect: () => {} },
            ]},
            { title: 'Feeling Unwell', description: 'You\'ve caught a cold. Where do you go?', options: [
                 { text: 'Klinik Kesihatan (-RM 5)', effect: () => gameState.balance -= 5 },
                 { text: 'Private GP Clinic (-RM 80)', effect: () => gameState.balance -= 80 },
                 { text: 'Just buy Panadol at the pharmacy (-RM 10)', effect: () => gameState.balance -= 10 },
            ]},
            { title: 'ASB Financing', description: 'A bank agent explains ASB financing to you. You can take a loan to maximise your ASB investment, but you have to pay it back monthly.', options: [
                 { text: 'Start a RM50k financing (-RM250/mth)', effect: () => {gameState.monthlyCommitments += 250; addAchievement('Leveraged Investor', 'Started an ASB Financing plan.'); showToast('New Commitment!', 'You now have a monthly loan repayment of RM250.', 'info');} },
                 { text: 'No, thank you. I prefer cash.', effect: () => {} },
            ]},
            { title: 'Balik Kampung', description: 'It\'s a long weekend! Time to visit your family in your hometown.', options: [
                 { text: 'Drive back (Petrol & Tolls) (-RM 150)', effect: () => gameState.balance -= 150 },
                 { text: 'Take an express bus (-RM 80)', effect: () => gameState.balance -= 80 },
                 { text: 'Sorry, can\'t make it this time', effect: () => {} },
            ]},
        ];

        // --- DOM Elements & State ---
        const ui = {
            themeToggle: document.getElementById('themeToggle'), calendar: document.getElementById('calendar'),
            balanceEl: document.getElementById('balance'), currentPositionEl: document.getElementById('currentPosition'),
            achievementsList: document.getElementById('achievementsList'), dice1: document.getElementById('dice1'),
            dice2: document.getElementById('dice2'), playerGamePin: document.getElementById('playerGamePin'),
            rollDiceBtn: document.getElementById('rollDiceBtn'), resetBtn: document.getElementById('resetBtn'),
            toastContainer: document.getElementById('toastContainer'), monthHeader: document.getElementById('monthHeader'),
        };

        const modals = {
            event: document.getElementById('eventModal'), confirm: document.getElementById('confirmModal'),
            welcome: document.getElementById('welcomeModal'),
        };
        const modalElements = {
            eventTitle: document.getElementById('eventTitle'), eventDescription: document.getElementById('eventDescription'),
            eventOptions: document.getElementById('eventOptions'), confirmTitle: document.getElementById('confirmTitle'),
            confirmMessage: document.getElementById('confirmMessage'), confirmBtn: document.getElementById('confirmBtn'),
        };

        let gameState = {};
        const initialGameState = {
            currentDay: 1, balance: 2000, achievements: [], gameInProgress: true, 
            salary: 2500, gameWon: false, monthlyCommitments: 0,
            paydays: [15, 30, 45, 60]
        };
        let currentEvent = null;

        // --- Core Functions ---
        function initGame() {
            loadGameState(); setupDice(); updateAllUI(); setupEventListeners();
            if (localStorage.getItem('daduitGamePlayed_MY') !== 'true') {
                openModal('welcome');
            }
        }

        function loadGameState() {
            const savedState = localStorage.getItem('daduitGameState_MY');
            gameState = savedState ? { ...initialGameState, ...JSON.parse(savedState) } : { ...initialGameState };
            saveGameState();
        }
        
        function saveGameState() { localStorage.setItem('daduitGameState_MY', JSON.stringify(gameState)); }
        function resetGame() { localStorage.removeItem('daduitGameState_MY'); location.reload(); }

        // --- UI Rendering ---
        function updateAllUI() {
            ui.balanceEl.textContent = `RM ${gameState.balance}`;
            ui.currentPositionEl.textContent = gameState.currentDay;
            ui.monthHeader.textContent = `Month ${Math.ceil(gameState.currentDay / 30)}`;
            renderCalendar(); renderAchievements(); updatePlayerPosition();
            if (gameState.balance < 0 && gameState.gameInProgress) gameOver();
            if (gameState.gameWon) gameWon();
        }
        
        function renderCalendar() {
            ui.calendar.innerHTML = '';
            for (let day = 1; day <= 60; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';
                dayEl.textContent = day;
                if (day === gameState.currentDay) dayEl.classList.add('current');
                if (gameState.paydays.includes(day)) dayEl.classList.add('payday');
                ui.calendar.appendChild(dayEl);
            }
        }

        function updatePlayerPosition() {
            const gamePath = document.getElementById('gamePath');
            const targetLeft = ((gameState.currentDay - 1) / 59) * (gamePath.offsetWidth - ui.playerGamePin.offsetWidth);
            ui.playerGamePin.style.left = `${targetLeft}px`;
            ui.playerGamePin.classList.add('is-moving');
            setTimeout(() => ui.playerGamePin.classList.remove('is-moving'), 500);
        }

        // --- Game Logic ---
        function rollDice() {
            if (gameState.isRolling) return;
            gameState.isRolling = true;
            ui.rollDiceBtn.disabled = true;

            const value1 = Math.floor(Math.random() * 6) + 1;
            const value2 = Math.floor(Math.random() * 6) + 1;
            const total = value1 + value2;
            
            const rotations = { 1: "rotateX(0deg) rotateY(0deg)", 2: "rotateX(0deg) rotateY(180deg)", 3: "rotateX(0deg) rotateY(90deg)", 4: "rotateX(0deg) rotateY(-90deg)", 5: "rotateX(90deg) rotateY(0deg)", 6: "rotateX(-90deg) rotateY(0deg)" };
            
            ui.dice1.style.transform = `rotateX(${Math.random()*1440}deg) rotateY(${Math.random()*1440}deg)`;
            ui.dice2.style.transform = `rotateX(${Math.random()*1440}deg) rotateY(${Math.random()*1440}deg)`;

            setTimeout(() => {
                ui.dice1.style.transform = rotations[value1];
                ui.dice2.style.transform = rotations[value2];
                setTimeout(() => movePlayer(total), 1000);
            }, 1500);
        }

        async function movePlayer(steps) {
            showToast("You rolled a " + steps, `Moving ${steps} spaces...`, "info");
            for (let i = 0; i < steps; i++) {
                if (gameState.currentDay >= 60) break;
                gameState.currentDay++;
                await new Promise(resolve => setTimeout(resolve, 150));
                updatePlayerPosition(); updateAllUI();
            }

            if (gameState.currentDay >= 60 && gameState.gameInProgress) {
                gameState.currentDay = 60; gameState.gameWon = true;
                gameWon();
            } else {
                setTimeout(triggerDayEvent, 500);
            }
            saveGameState();
        }

        function triggerDayEvent() {
            if (gameState.paydays.includes(gameState.currentDay)) {
                let netSalary = gameState.salary - gameState.monthlyCommitments;
                gameState.balance += netSalary;
                let salaryMessage = `You received your salary of RM ${gameState.salary}.`;
                if(gameState.monthlyCommitments > 0) {
                    salaryMessage += ` After RM${gameState.monthlyCommitments} in commitments, you get RM${netSalary}.`;
                }
                showToast("Gaji Dah Masuk!", salaryMessage, "success");
                launchConfetti();
                ui.rollDiceBtn.disabled = false;
                gameState.isRolling = false;
            } else {
                currentEvent = eventPool[Math.floor(Math.random() * eventPool.length)];
                openModal('event', currentEvent);
            }
            updateAllUI();
            saveGameState();
        }
        
        function gameOver() {
            gameState.gameInProgress = false; saveGameState();
            openModal('confirm', { title: "Game Over!", message: "Aiyoo, your balance is negative! Kena try again next time.", onConfirm: resetGame, confirmText: 'Restart' });
        }
        
        function gameWon() {
            gameState.gameInProgress = false; saveGameState(); launchConfetti(200);
            openModal('confirm', { title: "You Won!", message: "Fuyoh! You survived 2 months and managed your finances like a boss! You're a true DADUit champion.", onConfirm: resetGame, confirmText: 'Play Again' });
        }

        // --- Event Handlers & Setup ---
        function setupEventListeners() {
            ui.themeToggle.addEventListener('click', () => { document.documentElement.classList.toggle('dark'); localStorage.setItem('darkMode_MY', document.documentElement.classList.contains('dark')); });
            ui.rollDiceBtn.addEventListener('click', rollDice);
            ui.resetBtn.addEventListener('click', () => openModal('confirm', { title: 'Reset Game', message: 'Are you sure? All progress will be lost.', onConfirm: resetGame, confirmText: 'Yes, Reset' }));
            document.querySelectorAll('.modal-close').forEach(el => el.addEventListener('click', () => closeModal(el.closest('.modal'))));
            document.querySelectorAll('.modal').forEach(el => el.addEventListener('click', e => { if (e.target === el) closeModal(el); }));
            document.getElementById('startGameBtn').addEventListener('click', () => { localStorage.setItem('daduitGamePlayed_MY', 'true'); closeModal(modals.welcome); });
            document.getElementById('cancelConfirmBtn').addEventListener('click', () => closeModal(modals.confirm));
            
            modalElements.eventOptions.addEventListener('click', e => {
                const optionEl = e.target.closest('.modal-option[data-index]');
                if (!optionEl || !currentEvent) return;
                const index = parseInt(optionEl.dataset.index, 10);
                if (currentEvent.options && currentEvent.options[index]) {
                    currentEvent.options[index].effect();
                    closeModal(modals.event);
                    ui.rollDiceBtn.disabled = false;
                    gameState.isRolling = false;
                    updateAllUI(); saveGameState();
                }
            });
        }

        function openModal(type, data = {}) {
            const modal = modals[type];
            if (!modal) return;
            if (type === 'confirm') {
                modalElements.confirmTitle.textContent = data.title;
                modalElements.confirmMessage.textContent = data.message;
                modalElements.confirmBtn.textContent = data.confirmText || 'Confirm';
                const newConfirmBtn = modalElements.confirmBtn.cloneNode(true);
                modalElements.confirmBtn.parentNode.replaceChild(newConfirmBtn, modalElements.confirmBtn);
                newConfirmBtn.addEventListener('click', data.onConfirm);
                modalElements.confirmBtn = newConfirmBtn;
            } else if (type === 'event') {
                modalElements.eventTitle.textContent = data.title;
                modalElements.eventDescription.textContent = data.description;
                modalElements.eventOptions.innerHTML = '';
                data.options.forEach((opt, i) => {
                    const btn = document.createElement('div');
                    btn.className = 'modal-option';
                    btn.dataset.index = i;
                    btn.innerHTML = `<span class="option-text">${opt.text}</span>`;
                    modalElements.eventOptions.appendChild(btn);
                });
            }
            modal.style.display = 'flex';
        }
        function closeModal(modal) { modal.style.display = 'none'; }
        
        function setupDice() {
            [ui.dice1, ui.dice2].forEach(diceEl => {
                diceEl.innerHTML = ''; // Clear it out
                for (let i = 1; i <= 6; i++) {
                    let dotsHTML = '';
                    for (let j = 0; j < i; j++) { dotsHTML += '<span class="dice-dot"></span>'; }
                    const face = document.createElement('div');
                    face.className = 'dice-face';
                    face.innerHTML = `<div class="dice-dot-container face-${i}">${dotsHTML}</div>`;
                    diceEl.appendChild(face);
                }
            });
        }
        function addAchievement(title,description){if(gameState.achievements.some(a=>a.title===title))return;gameState.achievements.push({title,description});showToast("Achievement Unlocked!",title,"success");renderAchievements()}
        function renderAchievements(){ui.achievementsList.innerHTML='';if(gameState.achievements.length===0){ui.achievementsList.innerHTML='<p style="padding:10px;color:var(--neutral-color)">No achievements yet.</p>';return}
        gameState.achievements.forEach(ach=>{const item=document.createElement('div');item.className='achievement-item';item.innerHTML=`<i class="fas fa-trophy achievement-icon"></i><div><strong>${ach.title}</strong><br><small>${ach.description}</small></div>`;ui.achievementsList.appendChild(item)})}
        function showToast(title,message,type="info"){const toast=document.createElement('div');toast.classList.add('toast',type);const icons={success:'fa-check-circle',warning:'fa-exclamation-triangle',error:'fa-times-circle',info:'fa-info-circle'};toast.innerHTML=`<i class="fas ${icons[type]} toast-icon"></i><div><div class=toast-title>${title}</div><div>${message}</div></div>`;ui.toastContainer.appendChild(toast);setTimeout(()=>{toast.style.animation='slideOut .5s forwards';setTimeout(()=>toast.remove(),500)},4000)}
        function launchConfetti(count=100){const colors=['#6366F1','#8B5CF6','#EC4899','#F59E0B','#10B981'];for(let i=0;i<count;i++){const confetti=document.createElement('div');confetti.classList.add('confetti');confetti.style.left=Math.random()*window.innerWidth+'px';confetti.style.top=-20+'px';confetti.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];confetti.style.transform=`rotate(${Math.random()*360}deg)`;document.body.appendChild(confetti);const anim=confetti.animate([{top:-20+'px',opacity:1},{top:window.innerHeight+20+'px',opacity:0}],{duration:Math.random()*3000+3000,easing:'linear'});anim.onfinish=()=>confetti.remove()}}

        initGame();
    });
    </script>
</body>
</html>
